<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prayer Times</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/adhans/1.2.1/Adhan.min.js"></script>
    <style>
        body {
            background: #050a12;
            color: white;
            font-family: -apple-system, sans-serif;
            display: flex;
            justify-content: center;
            margin: 0;
            padding: 20px;
        }
        .container { width: 100%; max-width: 400px; text-align: center; }
        .timer-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .countdown { font-size: 36px; font-weight: bold; }
        .prayer-list { display: flex; flex-direction: column; gap: 12px; }
        .prayer-item {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 18px;
            padding: 18px 25px;
            display: flex;
            justify-content: space-between;
            border: 1px solid transparent;
        }
        .active { border-color: #4cc9f0; background: rgba(76, 201, 240, 0.05); }
        .city-name { font-size: 24px; margin-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div id="city" class="city-name">Определение...</div>
        
        <div class="timer-card">
            <div style="text-align: left;">
                <div style="font-size: 12px; opacity: 0.6;">До следующей молитвы</div>
                <div id="timer" class="countdown">00:00:00</div>
            </div>
            <div id="next-prayer-name" style="font-size: 14px;">...</div>
        </div>

        <div class="prayer-list" id="list">
            </div>
    </div>

    <script>
        function updatePrayers() {
            navigator.geolocation.getCurrentPosition(position => {
                const coords = new adhan.Coordinates(position.coords.latitude, position.coords.longitude);
                const params = adhan.CalculationMethod.UmmAlQura();
                const date = new Date();
                const prayerTimes = new adhan.PrayerTimes(coords, date, params);

                // Список для отображения
                const names = ["Fajr", "Sunrise", "Dhuhr", "Asr", "Maghrib", "Isha"];
                const times = [prayerTimes.fajr, prayerTimes.sunrise, prayerTimes.dhuhr, prayerTimes.asr, prayerTimes.maghrib, prayerTimes.isha];
                
                let listHtml = "";
                const next = prayerTimes.nextPrayer();
                
                names.forEach((name, i) => {
                    if (name === "Sunrise") return; // Пропускаем восход в списке
                    const isNext = (next === i || (next === 'none' && i === 0));
                    const timeStr = times[i].toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'});
                    listHtml += `<div class="prayer-item ${isNext ? 'active' : ''}">
                        <span>${name}</span>
                        <span>${timeStr}</span>
                    </div>`;
                    if(isNext) document.getElementById('next-prayer-name').innerText = 'до ' + name;
                });
                
                document.getElementById('list').innerHTML = listHtml;
                document.getElementById('city').innerText = "Ваша локация";

                // Обратный отсчет
                setInterval(() => {
                    const now = new Date();
                    const nextTime = prayerTimes.timeForPrayer(next) || prayerTimes.fajr; // Если все прошли, берем завтрашний Фаджр
                    let diff = nextTime - now;
                    if (diff < 0) diff += 86400000; // Добавляем 24 часа если время вышло

                    const h = Math.floor(diff/3600000).toString().padStart(2, '0');
                    const m = Math.floor((diff%3600000)/60000).toString().padStart(2, '0');
                    const s = Math.floor((diff%60000)/1000).toString().padStart(2, '0');
                    document.getElementById('timer').innerText = `${h}:${m}:${s}`;
                }, 1000);
            });
        }
        updatePrayers();
    </script>
</body>
</html>
